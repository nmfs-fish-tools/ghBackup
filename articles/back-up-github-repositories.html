<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ghBackup">
<title>Back up GitHub repositories • ghBackup</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Back up GitHub repositories">
<meta property="og:description" content="ghBackup">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ghBackup</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/back-up-github-repositories.html">Back up GitHub repositories</a>
    <a class="dropdown-item" href="../articles/check_gh_size.html">Check GH size</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Back up GitHub repositories</h1>
                        <h4 data-toc-skip class="author">Bai Li</h4>
            
            <h4 data-toc-skip class="date">9/26/2022</h4>
      
      
      <div class="d-none name"><code>back-up-github-repositories.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This R package helps back up GitHub repositories from an organization using R. To install the package from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Bai-Li-NOAA/ghBackup"</span><span class="op">)</span></span></code></pre></div>
<p>You can read the help file with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">ghBackup</span><span class="fu">::</span><span class="va"><a href="../reference/back_up_gh_orgs.html">back_up_gh_orgs</a></span></span></code></pre></div>
<p>The <code><a href="../reference/back_up_gh_orgs.html">back_up_gh_orgs()</a></code> function requires a GitHub token, a destination directory, and the organization name of the repositories. It then uses the token to clone repositories from the GitHub organization and save the files in the destination directory. The run will download clones of all public and private repositories the token can access.</p>
</div>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<div class="section level3">
<h3 id="create-a-token">Create a token<a class="anchor" aria-label="anchor" href="#create-a-token"></a>
</h3>
<p>A new personal GitHub token can be created from the GitHub settings -&gt; Developer settings -&gt; Personal access tokens tab. More instructions can be found on the GitHub <a href="https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" class="external-link">“creating a personal access token”</a> website.</p>
<p>Once you have a token, you can use it with the <code>gh_token</code> argument in the <code><a href="../reference/back_up_gh_orgs.html">back_up_gh_orgs()</a></code> function. There are two options to set up <code>gh_token</code>.</p>
<ul>
<li><p>Option 1: simply provide token in an R script and do not share the token with others. For example, <code>gh_token = "abcdefghijklmnopqrstuvwxyz01234567890123"</code></p></li>
<li><p>Option 2 (<strong>Recommended</strong>): Use R package <code>gitcreds</code> to manage GitHub credentials without printing out the token in an R script. <code>gitcreds::gitcreds_set()</code> adds Git credentials in the credential stores and <code>gh::gh_token()</code> can be used to return the local user’s token. Please see <a href="https://github.com/r-lib/gitcreds" class="external-link">gitcreds website</a> and <a href="https://gh.r-lib.org/reference/gh_token.html" class="external-link">gh website</a> for more details. The token will not be shared when sharing the R script.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="back-up-repositories">Back up repositories<a class="anchor" aria-label="anchor" href="#back-up-repositories"></a>
</h3>
<p>To back up all repositories from, for example, <code>nmfs-fish-tools</code> and <code>nmfs-general-modeling-tools</code> to <code>C:/Users/ghbackup/</code> using <code>gh::gh_token()</code>, you can use the following R code in an R script:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/back_up_gh_orgs.html">back_up_gh_orgs</a></span><span class="op">(</span></span>
<span> gh_token <span class="op">=</span> <span class="fu">gh</span><span class="fu">::</span><span class="fu">gh_token</span><span class="op">(</span><span class="op">)</span>,</span>
<span> backup_path <span class="op">=</span> <span class="st">"C:/Users/ghbackup/"</span>,</span>
<span> orgs_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nmfs-fish-tools"</span>, <span class="st">"nmfs-general-modeling-tools"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Clones of all repositories will be saved in the <code>C:/Users/ghbackup/</code> directory and a zip archives of clones of all repositories will be created under parent directory <code>C:/Users/</code>.</p>
</div>
<div class="section level3">
<h3 id="upload-the-zip-file-to-a-google-drive-folder">Upload the zip file to a Google Drive folder<a class="anchor" aria-label="anchor" href="#upload-the-zip-file-to-a-google-drive-folder"></a>
</h3>
<p>Thanks <span class="citation">@k-doering-NOAA</span> for providing the solution. This approach uses an auto auth setting so no interaction is needed. See gargle’s <a href="https://gargle.r-lib.org/articles/non-interactive-auth.html" class="external-link">“Non-interactive auth”</a> vignette for more details:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>gargle_oauth_email <span class="op">=</span> <span class="st">"*@noaa.gov"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zip_name</span> <span class="op">&lt;-</span> <span class="st">"ghBackup.zip"</span></span>
<span><span class="va">zip_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">backup_path</span><span class="op">)</span>, <span class="va">zip_name</span><span class="op">)</span></span>
<span><span class="fu">googledrive</span><span class="fu">::</span><span class="fu">drive_put</span><span class="op">(</span></span>
<span>  media <span class="op">=</span> <span class="va">zip_path</span>,</span>
<span>  path <span class="op">=</span> <span class="fu">googledrive</span><span class="fu">::</span><span class="fu">as_id</span><span class="op">(</span><span class="st">"https://drive.google.com/drive/folders/1vju2qQ0dPh49Ay7VGaWv6CvGqMZsZKPc"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="va">zip_name</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The full R script example can be found here: <a href="https://github.com/Bai-Li-NOAA/ghBackup/blob/feat-check-repo-size/inst/extdata/examples/example_back_up_gh.R" class="external-link">inst/extdata/examples/example_back_up_gh.R</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="schedule-the-run">Schedule the run<a class="anchor" aria-label="anchor" href="#schedule-the-run"></a>
</h2>
<p>You can schedule the R script/workflow on Windows using the Windows task scheduler. To add a task in an R script, you need to install <a href="https://cran.r-project.org/web/packages/taskscheduleR/vignettes/taskscheduleR.html" class="external-link"><code>taskscheduleR</code></a> package and run the example code below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"taskscheduleR"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bnosac/taskscheduleR" class="external-link">taskscheduleR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R script with tasks</span></span>
<span><span class="va">task_script</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"example_back_up_gh.R"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"ghBackup"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run every 5 mins, starting from within 60 seconds</span></span>
<span><span class="fu">taskscheduleR</span><span class="fu">::</span><span class="fu">taskscheduler_create</span><span class="op">(</span></span>
<span>  taskname <span class="op">=</span> <span class="st">"ghBackup_5min"</span>,</span>
<span>  rscript <span class="op">=</span> <span class="va">task_script</span> ,</span>
<span>  schedule <span class="op">=</span> <span class="st">"MINUTE"</span>,</span>
<span>  startdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%m/%d/%Y"</span><span class="op">)</span>,</span>
<span>  starttime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">60</span>, <span class="st">"%H:%M"</span><span class="op">)</span>,</span>
<span>  modifier <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The full R script example can be found here: <a href="https://github.com/Bai-Li-NOAA/ghBackup/blob/feat-check-repo-size/inst/extdata/examples/example_task_schedule.R" class="external-link">inst/extdata/examples/example_task_schedule.R</a>.</p>
<p>You might be interested in <a href="https://github.com/bnosac/cronR" class="external-link">cronR package</a> if you would like to automate R workflow on Linux/Unix.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bai Li, Giselle Schmitz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
